window.GGBT_ws_header_footer=function($){"use strict";var wsScroller=null;var wsInfoScroller=null;var wsHeader=null;var feedbackHeader=null;var wsFooter=null;var worksheetSettings=null;var defaults=null;var general;function getWsScroller(){if(general!==undefined){return general.getWorkSheet()}else if(wsScroller===null){wsScroller=$(".wsf-ws-scroller")}return wsScroller}function getWsInfoScroller(){if(wsInfoScroller===null){wsInfoScroller=$(".wsf-info-scroller")}return wsInfoScroller}function getWsHeader(){if(general!==undefined){return general.getHeader()}else if(wsHeader===null){wsHeader=$(".j-ws-header")}return wsHeader}function getFeedbackHeader(){if(general!==undefined){return general.getFeedbackHeader()}else if(feedbackHeader===null){feedbackHeader=$(".j-feedback-header")}return feedbackHeader}function getWsFooter(){if(general!==undefined){return general.getFooter()}else if(wsFooter===null){wsFooter=$(".jWS-footer")}return wsFooter}function getWorksheetSettings(){if(worksheetSettings===null){worksheetSettings=$(".j-ws-settings")}return worksheetSettings}function initToogleWorksheetSettings(){console.log("init toggle ws settings");$(".j-ws-toggle-settings").click(function(){$(".j-ws-settings-content").slideToggle(function(){setWsScrollerHeight()});$(".j-ws-toogle-settings-icon").toggleClass("arrow-small-right arrow-small-up")})}function initShowWorksheetActionsPopupButton(){$(".j-worksheet-actions-button").on("click",function(){$(".j-worksheet-menu-content").fadeToggle("fast");$(".j-worksheet-actions-button").toggleClass("active")})}function initShowWorksheetAddElementPopupButton(){$(".j-worksheet-add-element-button").on("click",function(){$(".j-worksheet-add-element-content").fadeToggle("fast");$(".j-worksheet-add-element-button").toggleClass("active")})}function initShowWorksheetStudentsPopupButton(){$(".j-worksheet-students-button").on("click",function(){$(".j-students-popup").fadeToggle("fast");$(".j-worksheet-students-button").toggleClass("active")})}function initOnBodyClick(){$("body").click(function(e){if(!$(e.target).is(".j-worksheet-actions-button")){$(".j-worksheet-menu-content").fadeOut("fast");$(".j-worksheet-actions-button").removeClass("active")}if(!$(e.target).is(".j-worksheet-students-button")){$(".j-students-popup").fadeOut("fast");$(".j-worksheet-students-button").removeClass("active")}if(!$(e.target).is(".j-worksheet-add-element-button")){$(".j-worksheet-add-element-content").fadeOut("fast");$(".j-worksheet-add-element-button").removeClass("active")}})}function setWsScrollerHeight(){var bookMenu=$("#menu");getWsHeader().outerHeight("auto");var scrollerHeight=$(window).height()-getWsHeader().outerHeight()-getFeedbackHeader().outerHeight()-getWorksheetSettings().outerHeight();getWsScroller().height("auto");getWsInfoScroller().height("auto");if(getWsScroller().height()<scrollerHeight){getWsScroller().height(scrollerHeight)}if(bookMenu.length===1){if($("#menu-container").hasClass("open")){bookMenu.height("auto");if(bookMenu.height()>getWsScroller().height()){getWsScroller().height(bookMenu.height())}}else{bookMenu.height(scrollerHeight)}}var infoWrapper=getWsInfoScroller().parent();if(!infoWrapper.hasClass("fullscreen")){getWsInfoScroller().height(scrollerHeight-20)}}function initButtons(){initKeep();initDelete()}function initKeep(){$(".jKeep").click(function(e){e.preventDefault();var button=$(this);$.get(button.attr("href")).success(function(result){if(result.type=="success"){var header=button.parents(".j-ws-header");var material_id=$(".jWs-tools",header).data("id");var title=header.data("title").trim();if(result.newData){button.addClass("icon-is-favorite");gaTrackFavoriteMaterial("unfavorite",material_id);var viewFavoritesBtn=$('<button class="button" id="popup-btn-view-favorites">'+defaults.btn_favorite_view+"</button>");viewFavoritesBtn.click(function(){window.open(defaults.favorites_url,"_blank")});window.GGBT_gen_modal.showMessagePopup(defaults.msg_favorite_add.replace("{$1}",title),viewFavoritesBtn,true,defaults.btn_ok)}else{button.removeClass("icon-is-favorite");gaTrackFavoriteMaterial("favorite",material_id);window.GGBT_gen_modal.showMessagePopup(defaults.msg_favorite_remove.replace("{$1}",title),null,true,defaults.btn_ok)}}});return false})}function initDelete(){$(".jDelete").on("click",function(e){e.preventDefault();var li=$(e.target).hasClass("jDelete")?$(e.target):$(e.target).parents(".jDelete");var save=window.confirm(li.data("confirm"));if(save){window.location=li.find("a").attr("href")}})}$(window).resize(function(){setWsScrollerHeight()});function onSwitchWorksheet(worksheet){setWsScrollerHeight()}function init(){general=window.GGBT_wsf_general;getWsScroller();initToogleWorksheetSettings();initShowWorksheetActionsPopupButton();initShowWorksheetStudentsPopupButton();initShowWorksheetAddElementPopupButton();initOnBodyClick();initButtons();setWsScrollerHeight()}function setDefaults(data){defaults=data}return{init:init,setDefaults:setDefaults,onSwitchWorksheet:onSwitchWorksheet,setWsScrollerHeight:setWsScrollerHeight}}(jQuery);$(document).ready(function(){"use strict";window.GGBT_ws_header_footer.init()});